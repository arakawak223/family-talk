# FamilyTalk テスト実行ガイド

本番環境で家族が使用する前に、すべての機能をテストして動作確認を行います。

## テスト環境の準備

### Webアプリ（Next.js）
```bash
cd family
npm install
npm run dev
# http://localhost:3000 でアクセス
```

### モバイルアプリ（React Native）

**Android**:
```bash
cd FamilyTalk
npm install
npm run android
```

**iOS** (macOS のみ):
```bash
cd FamilyTalk
npm install
cd ios && pod install && cd ..
npm run ios
```

## テストシナリオ

### 1. ユーザー登録とログイン

#### 1.1 新規ユーザー登録（Webアプリ）
- [ ] トップページにアクセス
- [ ] 「新規登録」ボタンをクリック
- [ ] メールアドレスとパスワードを入力（パスワード: 8文字以上）
- [ ] 「登録」ボタンをクリック
- [ ] **期待結果**: 登録完了メッセージが表示される
- [ ] メール認証が必要な場合、メールを確認して認証リンクをクリック

#### 1.2 ログイン（Webアプリ）
- [ ] トップページの「ログイン」をクリック
- [ ] 登録したメールアドレスとパスワードを入力
- [ ] 「ログイン」ボタンをクリック
- [ ] **期待結果**: ダッシュボードまたはホーム画面に遷移

#### 1.3 ログアウト
- [ ] ユーザーメニューから「ログアウト」をクリック
- [ ] **期待結果**: トップページに戻る

#### 1.4 新規ユーザー登録（モバイルアプリ）
- [ ] アプリを起動
- [ ] 「Sign Up」ボタンをタップ
- [ ] メールアドレス、パスワード、表示名を入力
- [ ] 「Sign Up」ボタンをタップ
- [ ] **期待結果**: 登録完了後、ホーム画面に遷移

#### 1.5 ログイン（モバイルアプリ）
- [ ] アプリを起動
- [ ] メールアドレスとパスワードを入力
- [ ] 「Sign In」ボタンをタップ
- [ ] **期待結果**: ホーム画面に遷移

### 2. プロフィール設定

#### 2.1 プロフィール編集（Webアプリ）
- [ ] ダッシュボードから「プロフィール」をクリック
- [ ] 表示名を変更
- [ ] 電話番号を追加
- [ ] 「保存」ボタンをクリック
- [ ] **期待結果**: 変更が保存され、成功メッセージが表示される

#### 2.2 アバター画像のアップロード（Webアプリ）
- [ ] プロフィール画面で「アバター変更」をクリック
- [ ] 画像ファイルを選択（5MB以下の画像）
- [ ] 「アップロード」をクリック
- [ ] **期待結果**: アバター画像が更新される

### 3. 家族グループの作成と参加

#### 3.1 家族グループの作成（Webアプリ）
- [ ] ダッシュボードから「家族グループを作成」をクリック
- [ ] 家族グループ名を入力（例: 「田中家」）
- [ ] 説明を入力（オプション）
- [ ] 「作成」ボタンをクリック
- [ ] **期待結果**: 家族グループが作成され、招待コードが表示される
- [ ] 招待コードをメモする（例: ABC123）

#### 3.2 家族グループへの参加（別のユーザー）
- [ ] 別のアカウントでログイン（または新規登録）
- [ ] 「家族グループに参加」をクリック
- [ ] 招待コードを入力
- [ ] 「参加」ボタンをクリック
- [ ] **期待結果**: 家族グループに参加し、メンバー一覧に表示される

#### 3.3 家族グループの作成（モバイルアプリ）
- [ ] ホーム画面から「Create Family Group」をタップ
- [ ] 家族グループ名を入力
- [ ] 「Create」ボタンをタップ
- [ ] **期待結果**: 家族グループが作成され、招待コードが表示される

#### 3.4 家族グループへの参加（モバイルアプリ）
- [ ] ホーム画面から「Join Family Group」をタップ
- [ ] 招待コードを入力
- [ ] 「Join」ボタンをタップ
- [ ] **期待結果**: 家族グループに参加

### 4. 音声メッセージの録音と送信

#### 4.1 質問の選択（Webアプリ）
- [ ] ダッシュボードから「メッセージを送る」をクリック
- [ ] 質問カテゴリを選択（例: 「日常の会話」）
- [ ] 気持ちを選択（例: 「相手に興味を持っていることを伝えたい」）
- [ ] 質問候補から1つ選択（例: 「今日はどんな一日だった？」）
- [ ] **期待結果**: 質問が選択され、録音画面に遷移

#### 4.2 音声の録音（Webアプリ）
- [ ] マイク権限を許可（ブラウザが要求）
- [ ] 「録音開始」ボタンをクリック
- [ ] 10秒程度話す（例: 「こんにちは、今日はどんな一日だった？」）
- [ ] 「録音停止」ボタンをクリック
- [ ] **期待結果**: 録音が停止し、音声が保存される

#### 4.3 録音の再生確認（Webアプリ）
- [ ] 「再生」ボタンをクリック
- [ ] **期待結果**: 録音した音声が再生される
- [ ] 必要に応じて「再録音」で録り直し

#### 4.4 音声メッセージの送信（Webアプリ）
- [ ] 送信先を選択（個別メンバーまたはグループ全体）
- [ ] 「送信」ボタンをクリック
- [ ] **期待結果**: 送信完了メッセージが表示され、メッセージ一覧に追加される

#### 4.5 質問の選択（モバイルアプリ）
- [ ] ホーム画面から「Select Question」をタップ
- [ ] 気持ちを選択
- [ ] 質問候補から1つ選択
- [ ] **期待結果**: 質問が選択され、録音画面に遷移

#### 4.6 音声の録音（モバイルアプリ）
- [ ] マイク権限を許可（初回のみ）
- [ ] マイクボタンを長押しして録音開始
- [ ] 10秒程度話す
- [ ] ボタンを離して録音停止
- [ ] **期待結果**: 録音が停止し、波形が表示される

#### 4.7 音声メッセージの送信（モバイルアプリ）
- [ ] 「Play」で再生確認
- [ ] 「Send」ボタンをタップ
- [ ] **期待結果**: 送信完了通知が表示される

### 5. 音声メッセージの受信と再生

#### 5.1 メッセージ一覧の確認（Webアプリ）
- [ ] 別のユーザーアカウントでログイン
- [ ] ダッシュボードのメッセージ一覧を確認
- [ ] **期待結果**: 送信されたメッセージが「未読」として表示される

#### 5.2 音声メッセージの再生（Webアプリ）
- [ ] メッセージをクリック
- [ ] 「再生」ボタンをクリック
- [ ] **期待結果**: 音声が再生され、メッセージが「既読」になる

#### 5.3 メッセージ一覧の確認（モバイルアプリ）
- [ ] 別のユーザーアカウントでログイン
- [ ] 「Messages」タブをタップ
- [ ] **期待結果**: 受信したメッセージが一覧表示される（封筒アイコン）

#### 5.4 音声メッセージの再生（モバイルアプリ）
- [ ] メッセージをタップして開封
- [ ] **期待結果**: 封筒が開く演出が表示される
- [ ] 自動再生または「Play」ボタンで再生
- [ ] **期待結果**: 音声が再生される

### 6. グループメッセージ

#### 6.1 グループ全体へのメッセージ送信
- [ ] 「メッセージを送る」で質問を選択
- [ ] 送信先で「グループ全体」を選択
- [ ] 音声を録音して送信
- [ ] **期待結果**: 家族グループのすべてのメンバーにメッセージが届く

#### 6.2 複数人からの受信確認
- [ ] 各メンバーのアカウントでログイン
- [ ] メッセージ一覧を確認
- [ ] **期待結果**: すべてのメンバーがメッセージを受信

### 7. 関西弁機能のテスト

#### 7.1 関西弁の質問選択
- [ ] 質問選択画面で「関西弁で話そう」を選択
- [ ] **期待結果**: 関西弁の質問候補が表示される
  - 例: 「今日はなんしよん？」
  - 例: 「今日はどないやった？」

#### 7.2 関西弁メッセージの送信
- [ ] 関西弁の質問を選択して録音・送信
- [ ] **期待結果**: 正常に送信され、受信側で質問が表示される

### 8. エラーハンドリングのテスト

#### 8.1 ネットワークエラー
- [ ] ネットワークを切断（機内モードON）
- [ ] ログインを試みる
- [ ] **期待結果**: エラーメッセージが表示される
- [ ] ネットワークを再接続
- [ ] 再度ログインを試みる
- [ ] **期待結果**: 正常にログインできる

#### 8.2 ファイルサイズ超過
- [ ] 10MB以上の音声ファイルをアップロード（可能であれば）
- [ ] **期待結果**: エラーメッセージが表示され、アップロードが拒否される

#### 8.3 不正な招待コード
- [ ] 存在しない招待コードで家族グループに参加を試みる
- [ ] **期待結果**: エラーメッセージが表示される

### 9. パフォーマンステスト

#### 9.1 大量メッセージの読み込み
- [ ] 10件以上のメッセージを送信
- [ ] メッセージ一覧を開く
- [ ] **期待結果**: 一覧がスムーズに表示される（ロード時間: 3秒以内）

#### 9.2 長時間録音
- [ ] 60秒以上の音声を録音
- [ ] 送信してみる
- [ ] **期待結果**: 正常に録音・送信・再生できる

### 10. セキュリティテスト

#### 10.1 別ユーザーのデータアクセス
- [ ] ユーザーAでログイン
- [ ] ブラウザのコンソールでユーザーBのIDを使ってデータ取得を試みる
- [ ] **期待結果**: アクセス拒否エラーが発生（RLSが正しく機能）

#### 10.2 ログアウト後のアクセス
- [ ] ログアウトする
- [ ] ブラウザの戻るボタンで保護されたページにアクセス
- [ ] **期待結果**: ログインページにリダイレクトされる

## テスト結果の記録

各テストケースの実行結果を記録してください。

### テスト結果テンプレート

```
テスト日時: YYYY-MM-DD HH:MM
テスト環境: [Web / Android / iOS]
テスター名:

| テストケース | 結果 | 備考 |
|------------|------|------|
| 1.1 新規ユーザー登録 | ✅ / ❌ |  |
| 1.2 ログイン | ✅ / ❌ |  |
| ... | ... | ... |

問題が見つかった場合:
- 問題の詳細:
- 再現手順:
- エラーメッセージ:
- スクリーンショット: (あれば)
```

## トラブルシューティング

### 音声が録音できない
- ブラウザまたはアプリがマイク権限を持っているか確認
- デバイスのマイクが正常に動作しているか確認

### 音声が再生できない
- ブラウザのコンソールでエラーを確認
- 音声ファイルが正しくアップロードされているか確認（Supabase Storage）

### ログインできない
- メールアドレスとパスワードが正しいか確認
- メール認証が完了しているか確認（Supabaseの設定による）
- Supabaseの接続設定を確認（環境変数）

### メッセージが表示されない
- RLSポリシーが正しく設定されているか確認
- ブラウザのコンソールでAPIエラーを確認

## 次のステップ

すべてのテストケースが ✅ になったら:
1. 本番環境へのデプロイ
2. 家族メンバーへのアプリ配布
3. 実際に使用開始

問題が見つかった場合:
1. 問題を記録
2. 該当する設定やコードを修正
3. 再テスト